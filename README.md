# PRECiSA

PRECiSA (Program Round-off Error Certifier via Static Analysis) is a fully automatic analyzer for the estimation of round-off errors of floating-point valued functional expressions.
The input to PRECiSA is a program composed of floating-point valued functions. In its current version, PRECiSA accepts a subset of the language of the Prototype Verification System (PVS), including LET expressions, IF-THEN-ELSE constructions, non-recursive function calls, and floating point values and operations such as: addition, multiplication, division, subtraction, floor, and square root.
The analysis process performed by PRECiSA results in two PVS theories: (1) a theory containing a collection of lemmas that states symbolic accumulated round-off error estimations for every possible control flow of each function in the input program, and (2) a theory that can be used as input to PVS in order to generate similar lemmas but stating concrete bounds when domains for the input variables of the program are given. All these lemmas are equipped with PVS proof scripts that automatically discharge them. The numerical bounds are computed using a formally verified branch-and-bound algorithm.
For more information about PRECiSA or for using our web-interface visit [http://precisa.nianet.org](http://precisa.nianet.org).

Prerequisites
-------------

In order to compile or interpret PRECiSA you will need the [Glasgow Haskell Compiler](https://www.haskell.org/ghc), which is available as part of the [Haskell](https://www.haskell.org/platform) platform.
Furthermore, to generate the concrete bounds and to check the certificates, you will need [PVS version 6.0](http://pvs.csl.sri.com) and the development version of the [NASA PVS Library](https://github.com/nasa/pvslib).

How to compile PRECiSA
------------------

The directory `src` contains the Haskell source files implementing
PRECiSA. To compile PRECiSA, type the following commands in a Unix shell.

```bash
$ cd src
$ ghc PRECiSA.hs 
```

How to use PRECiSA
------------------

The first time that PRECiSA is used, create the directory `results` to
save the certificates generated by the tool.

```bash 
$ mkdir results 
```

To run PRECiSA 
```bash 
$ ./PRECiSA "<example>.pvs" "<example>.input" <maxdepth> <precision> <displayed-precision> <stable-test-assumption> <maxlemmas>
```

The first parameter is the PVS program to be analyzed, while the second one indicates the initial values for the input variables of the input program.
The third, fourth and fifth parameters are options for the branch and bound search: the maximum depth, the precision and the displayed precision, respectively.
The sixth parameters is a boolean value indicating whether the Stable Test Assumption is used (True) or not (False).
Finally, the last parameter is the maximum number of lemmas allowed to be generated by PRECiSA. This avoid to have certificates too big to be treated. If your program generates a huge number of lemmas, this means probably that you have several nested if-then-else. In this case, try to run PRECiSA with the Stable Test Assumption.

It is also possible to interpret PRECiSA via the GHCi interpreter as follows:

```
$ ghci
GHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help
Prelude> :l PRECiSA.hs 
```

In order to use PRECiSA, run the function `parseAndAnalysis` with the
same parameters explained above for the compiled version, e.g.,

```
*Main> parseAndAnalysis "example.pvs" "example.input" 4 14  2 False  40
```

How to check PRECiSA certificates in PVS
------------------

Once PVS and the PVS NASA Library have been installed in your system,
you can use PVS to check the symbolic certificate generated by PRECiSA
and also to generate concrete bounds. To do this, the directory `PVS` has to be added to the Unix environment variable
`PVS_LIBRARY_PATH`.  Depending upon your shell, put one of the following lines
in your startup script.  In C shell (csh or tcsh), put this line in
`~/.cshrc`, where `<precisadir>` is the absolute path to the PRECiSA directory:

~~~
setenv PVS_LIBRARY_PATH "<precisadir>/PVS:$PVS_LIBRARY_PATH"
~~~

In Borne shell (bash or sh), put this line in either `~/.bashrc or ~/.profile`:

~~~
export PVS_LIBRARY_PATH="<precisadir>/nasalib:$PVS_LIBRARY_PATH"
~~~

If you analyzed the predefined program `example.pvs`, in the directory `results` you will find two files: `cert_example.pvs` and `clgen_example.pvs`.

To check the correctness of the PVS certificates in `cert_example.pvs` you can run:

```
$ proveit -sc cert_example.pvs
```

In order to generate the concrete bound certificates, you can execute the following command:

```
$ pvsio @clgen_<example>:main
```

This process results in the generation of the file `clemmas_example.pvs`. You can find in that PVS theory the concrete bounds for every possible flow of each function, assuming the ranges provided for every input variable. To check the correctness of these lemmas, you can use the command proveit in a similar way:

```
$ proveit -sc clemmas_example.pvs
```

If any of these steps are not behaving as expected, try cleaning the
PVS binaries in the NASA Library. Simply run the script
`cleanbin-all`, available in the NASA Library directory of your installation, and try again.

Examples of PVS certificates generated by PRECiSA are available in the
directories [`PVS/CD2D_tau`](PVS/CD2D_tau) and [`PVS/CPR`](PVS/CPR/).

How to get the time PRECiSA takes to generate concrete bounds in PVSio
-------

When PVSio is run in batch mode, each example will include the time of
type-checking the PRECiSA development, which is about 4 minutes. To
get the time PRECiSA takes to generate concrete bounds in PVSio,
without incurring in the type-checking time penalty for every example,
PVSio needs to be run in interactive mode as follows.

1. Run PVS.

1. Load the file `clgen_<example>.pvs` into PVS .

1. Type-ccheck the file (M-x typecheck). The step for the first example
 take much longer than the other, since it has to type-check the
 PRECiSA framework.

1. Open PVSio, e.g., issue the following Emacs command `M-x pvsio`

1. In the PVSio read-eval loop, type 
```
PVSio> timing;
```

1. In the PVSio read-eval loop, type
```
PVSio> main;
```

1. Record the time reported by PVSio labeled `real time`.

1. In the PVSio read-eval loop, type
```
PVSio> exit;
```

1. Go to 2, but load another example. In this case, type-checking will take significantly less time.

License
-------

The PRECiSA is released under NASA's Open Source Agreement. See the file LICENSE.pdf; see also the copyright notice at the end of this file.

Copyright Notice
------------------

Copyright 2016 United States Government as represented by the Administrator of the National Aeronautics and Space Administration. All Rights Reserved.

No Warranty: THE SUBJECT SOFTWARE IS PROVIDED "AS IS" WITHOUT ANY WARRANTY OF ANY KIND, EITHER EXPRESSED, IMPLIED, OR STATUTORY, INCLUDING, BUT NOT LIMITED TO, ANY WARRANTY THAT THE SUBJECT SOFTWARE WILL CONFORM TO SPECIFICATIONS, ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR FREEDOM FROM INFRINGEMENT, ANY WARRANTY THAT THE SUBJECT SOFTWARE WILL BE ERROR FREE, OR ANY WARRANTY THAT DOCUMENTATION, IF PROVIDED, WILL CONFORM TO THE SUBJECT SOFTWARE. THIS AGREEMENT DOES NOT, IN ANY MANNER, CONSTITUTE AN ENDORSEMENT BY GOVERNMENT AGENCY OR ANY PRIOR RECIPIENT OF ANY RESULTS, RESULTING DESIGNS, HARDWARE, SOFTWARE PRODUCTS OR ANY OTHER APPLICATIONS RESULTING FROM USE OF THE SUBJECT SOFTWARE.  FURTHER, GOVERNMENT AGENCY DISCLAIMS ALL WARRANTIES AND LIABILITIES REGARDING THIRD-PARTY SOFTWARE, IF PRESENT IN THE ORIGINAL SOFTWARE, AND DISTRIBUTES IT "AS IS."

Waiver and Indemnity: RECIPIENT AGREES TO WAIVE ANY AND ALL CLAIMS AGAINST THE UNITED STATES GOVERNMENT, ITS CONTRACTORS AND SUBCONTRACTORS, AS WELL AS ANY PRIOR RECIPIENT.  IF RECIPIENT'S USE OF THE SUBJECT SOFTWARE RESULTS IN ANY LIABILITIES, DEMANDS, DAMAGES, EXPENSES OR LOSSES ARISING FROM SUCH USE, INCLUDING ANY DAMAGES FROM PRODUCTS BASED ON, OR RESULTING FROM, RECIPIENT'S USE OF THE SUBJECT SOFTWARE, RECIPIENT SHALL INDEMNIFY AND HOLD HARMLESS THE UNITED STATES GOVERNMENT, ITS CONTRACTORS AND SUBCONTRACTORS, AS WELL AS ANY PRIOR RECIPIENT, TO THE EXTENT PERMITTED BY LAW.  RECIPIENT'S SOLE REMEDY FOR ANY SUCH MATTER SHALL BE THE IMMEDIATE, UNILATERAL TERMINATION OF THIS AGREEMENT.

